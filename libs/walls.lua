Walls = {}

Walls.default = {{pos = {{0, 0}, {10, 0}}},
{pos = {{10, 10}, {0, 10}}},
{pos = {{0, 10}, {0, 0}}},
{pos = {{20, 0}, {20, 10}}},
{pos = {{20, 10}, {10, 10}}},
{pos = {{30, 10}, {20, 10}}},
{pos = {{20, 10}, {20, 0}}},
{pos = {{30, 0}, {40, 0}}},
{pos = {{40, 10}, {30, 10}}},
{pos = {{50, 0}, {50, 10}}},
{pos = {{50, 10}, {40, 10}}},
{pos = {{60, 10}, {50, 10}}},
{pos = {{50, 10}, {50, 0}}},
{pos = {{70, 0}, {70, 10}}},
{pos = {{70, 10}, {60, 10}}},
{pos = {{70, 0}, {80, 0}}},
{pos = {{80, 10}, {70, 10}}},
{pos = {{70, 10}, {70, 0}}},
{pos = {{80, 0}, {90, 0}}},
{pos = {{90, 10}, {80, 10}}},
{pos = {{100, 0}, {100, 10}}},
{pos = {{100, 10}, {90, 10}}},
{pos = {{10, 10}, {10, 20}}},
{pos = {{10, 20}, {0, 20}}},
{pos = {{0, 20}, {0, 10}}},
{pos = {{20, 10}, {20, 20}}},
{pos = {{10, 20}, {10, 10}}},
{pos = {{30, 10}, {30, 20}}},
{pos = {{20, 20}, {20, 10}}},
{pos = {{40, 10}, {40, 20}}},
{pos = {{40, 20}, {30, 20}}},
{pos = {{30, 20}, {30, 10}}},
{pos = {{40, 10}, {50, 10}}},
{pos = {{40, 20}, {40, 10}}},
{pos = {{50, 10}, {60, 10}}},
{pos = {{60, 10}, {60, 20}}},
{pos = {{70, 10}, {70, 20}}},
{pos = {{60, 20}, {60, 10}}},
{pos = {{80, 20}, {70, 20}}},
{pos = {{70, 20}, {70, 10}}},
{pos = {{80, 10}, {90, 10}}},
{pos = {{90, 20}, {80, 20}}},
{pos = {{100, 10}, {100, 20}}},
{pos = {{10, 20}, {10, 30}}},
{pos = {{0, 30}, {0, 20}}},
{pos = {{10, 20}, {20, 20}}},
{pos = {{10, 30}, {10, 20}}},
{pos = {{20, 20}, {30, 20}}},
{pos = {{30, 20}, {30, 30}}},
{pos = {{30, 20}, {40, 20}}},
{pos = {{30, 30}, {30, 20}}},
{pos = {{40, 20}, {50, 20}}},
{pos = {{50, 30}, {40, 30}}},
{pos = {{60, 20}, {60, 30}}},
{pos = {{60, 30}, {50, 30}}},
{pos = {{60, 20}, {70, 20}}},
{pos = {{60, 30}, {60, 20}}},
{pos = {{70, 20}, {80, 20}}},
{pos = {{80, 20}, {80, 30}}},
{pos = {{90, 20}, {90, 30}}},
{pos = {{90, 30}, {80, 30}}},
{pos = {{80, 30}, {80, 20}}},
{pos = {{100, 20}, {100, 30}}},
{pos = {{90, 30}, {90, 20}}},
{pos = {{0, 40}, {0, 30}}},
{pos = {{20, 40}, {10, 40}}},
{pos = {{20, 30}, {30, 30}}},
{pos = {{30, 40}, {20, 40}}},
{pos = {{30, 30}, {40, 30}}},
{pos = {{40, 40}, {30, 40}}},
{pos = {{40, 30}, {50, 30}}},
{pos = {{50, 40}, {40, 40}}},
{pos = {{60, 30}, {60, 40}}},
{pos = {{70, 40}, {60, 40}}},
{pos = {{60, 40}, {60, 30}}},
{pos = {{70, 30}, {80, 30}}},
{pos = {{80, 40}, {70, 40}}},
{pos = {{90, 30}, {90, 40}}},
{pos = {{100, 30}, {100, 40}}},
{pos = {{90, 40}, {90, 30}}},
{pos = {{10, 40}, {10, 50}}},
{pos = {{0, 50}, {0, 40}}},
{pos = {{10, 40}, {20, 40}}},
{pos = {{10, 50}, {10, 40}}},
{pos = {{30, 40}, {30, 50}}},
{pos = {{30, 50}, {20, 50}}},
{pos = {{30, 40}, {40, 40}}},
{pos = {{40, 50}, {30, 50}}},
{pos = {{30, 50}, {30, 40}}},
{pos = {{40, 40}, {50, 40}}},
{pos = {{50, 50}, {40, 50}}},
{pos = {{50, 40}, {60, 40}}},
{pos = {{60, 40}, {60, 50}}},
{pos = {{60, 40}, {70, 40}}},
{pos = {{60, 50}, {60, 40}}},
{pos = {{80, 40}, {80, 50}}},
{pos = {{80, 50}, {70, 50}}},
{pos = {{90, 40}, {90, 50}}},
{pos = {{80, 50}, {80, 40}}},
{pos = {{100, 40}, {100, 50}}},
{pos = {{90, 50}, {90, 40}}},
{pos = {{0, 50}, {10, 50}}},
{pos = {{0, 60}, {0, 50}}},
{pos = {{10, 50}, {20, 50}}},
{pos = {{20, 50}, {20, 60}}},
{pos = {{20, 60}, {10, 60}}},
{pos = {{20, 50}, {30, 50}}},
{pos = {{20, 60}, {20, 50}}},
{pos = {{30, 50}, {40, 50}}},
{pos = {{40, 60}, {30, 60}}},
{pos = {{50, 60}, {40, 60}}},
{pos = {{60, 60}, {50, 60}}},
{pos = {{70, 50}, {70, 60}}},
{pos = {{70, 60}, {60, 60}}},
{pos = {{80, 50}, {80, 60}}},
{pos = {{70, 60}, {70, 50}}},
{pos = {{80, 50}, {90, 50}}},
{pos = {{80, 60}, {80, 50}}},
{pos = {{90, 50}, {100, 50}}},
{pos = {{100, 50}, {100, 60}}},
{pos = {{10, 70}, {0, 70}}},
{pos = {{0, 70}, {0, 60}}},
{pos = {{10, 60}, {20, 60}}},
{pos = {{20, 70}, {10, 70}}},
{pos = {{20, 60}, {30, 60}}},
{pos = {{30, 70}, {20, 70}}},
{pos = {{40, 60}, {40, 70}}},
{pos = {{40, 70}, {30, 70}}},
{pos = {{40, 60}, {50, 60}}},
{pos = {{50, 60}, {50, 70}}},
{pos = {{40, 70}, {40, 60}}},
{pos = {{60, 60}, {60, 70}}},
{pos = {{50, 70}, {50, 60}}},
{pos = {{60, 60}, {70, 60}}},
{pos = {{70, 60}, {70, 70}}},
{pos = {{60, 70}, {60, 60}}},
{pos = {{80, 60}, {80, 70}}},
{pos = {{70, 70}, {70, 60}}},
{pos = {{90, 70}, {80, 70}}},
{pos = {{80, 70}, {80, 60}}},
{pos = {{100, 60}, {100, 70}}},
{pos = {{100, 70}, {90, 70}}},
{pos = {{10, 70}, {10, 80}}},
{pos = {{0, 80}, {0, 70}}},
{pos = {{10, 70}, {20, 70}}},
{pos = {{20, 80}, {10, 80}}},
{pos = {{10, 80}, {10, 70}}},
{pos = {{20, 70}, {30, 70}}},
{pos = {{30, 80}, {20, 80}}},
{pos = {{30, 70}, {40, 70}}},
{pos = {{40, 70}, {50, 70}}},
{pos = {{50, 80}, {40, 80}}},
{pos = {{60, 70}, {60, 80}}},
{pos = {{70, 80}, {60, 80}}},
{pos = {{60, 80}, {60, 70}}},
{pos = {{70, 70}, {80, 70}}},
{pos = {{80, 70}, {80, 80}}},
{pos = {{90, 70}, {90, 80}}},
{pos = {{80, 80}, {80, 70}}},
{pos = {{90, 70}, {100, 70}}},
{pos = {{100, 70}, {100, 80}}},
{pos = {{90, 80}, {90, 70}}},
{pos = {{0, 90}, {0, 80}}},
{pos = {{20, 80}, {20, 90}}},
{pos = {{20, 90}, {10, 90}}},
{pos = {{30, 90}, {20, 90}}},
{pos = {{20, 90}, {20, 80}}},
{pos = {{30, 80}, {40, 80}}},
{pos = {{40, 90}, {30, 90}}},
{pos = {{50, 80}, {50, 90}}},
{pos = {{50, 90}, {40, 90}}},
{pos = {{50, 80}, {60, 80}}},
{pos = {{60, 80}, {60, 90}}},
{pos = {{50, 90}, {50, 80}}},
{pos = {{70, 80}, {70, 90}}},
{pos = {{60, 90}, {60, 80}}},
{pos = {{70, 80}, {80, 80}}},
{pos = {{80, 90}, {70, 90}}},
{pos = {{70, 90}, {70, 80}}},
{pos = {{80, 80}, {90, 80}}},
{pos = {{100, 80}, {100, 90}}},
{pos = {{100, 90}, {90, 90}}},
{pos = {{0, 90}, {10, 90}}},
{pos = {{10, 90}, {10, 100}}},
{pos = {{0, 100}, {0, 90}}},
{pos = {{10, 90}, {20, 90}}},
{pos = {{10, 100}, {10, 90}}},
{pos = {{20, 90}, {30, 90}}},
{pos = {{30, 90}, {40, 90}}},
{pos = {{40, 90}, {40, 100}}},
{pos = {{40, 100}, {30, 100}}},
{pos = {{40, 90}, {50, 90}}},
{pos = {{40, 100}, {40, 90}}},
{pos = {{50, 90}, {60, 90}}},
{pos = {{60, 100}, {50, 100}}},
{pos = {{60, 90}, {70, 90}}},
{pos = {{70, 90}, {80, 90}}},
{pos = {{80, 100}, {70, 100}}},
{pos = {{80, 90}, {90, 90}}},
{pos = {{90, 100}, {80, 100}}},
{pos = {{90, 90}, {100, 90}}},
{pos = {{100, 90}, {100, 100}}}
    -- {{100,100}, {100, 200}},
    --  {{100,100}, {200, 100}},
    -- {{200,200}, {100, 200}},
    -- {{200,200}, {200, 100}
}
Walls.list = Walls.default

function Walls:clear(walllist)
    for _, wall in ipairs(walllist) do
        if wall.body then
            print(wall.fixture:destroy())
            wall.body:destroy()
        end
    end
    walllist = {}
end

function Walls:generate(seed)
    Walls.list = {}
    local maze = {}
    local stack = {}
    local cellSize = 10
    local cols, rows
    local current
    local walls = {}

    function getNextNeighbor(cell)
        local neighbors = {}
        local directions = {
            {x = 0, y = -1, wall = 1}, -- top
            {x = 1, y = 0, wall = 2}, -- right
            {x = 0, y = 1, wall = 3}, -- bottom
            {x = -1, y = 0, wall = 4} -- left
        }

        for _, dir in ipairs(directions) do
            local nx, ny = cell.x + dir.x, cell.y + dir.y
            if nx > 0 and nx <= cols and ny > 0 and ny <= rows then
                local neighbor = maze[ny][nx]
                if not neighbor.visited then
                    table.insert(neighbors, neighbor)
                end
            end
        end

        if #neighbors > 0 then
            return neighbors[math.random(#neighbors)]
        else
            return nil
        end
    end

    function removeWalls(current, next)
        local x = current.x - next.x
        local y = current.y - next.y

        if x == 1 then
            current.walls[4] = false
            next.walls[2] = false
        elseif x == -1 then
            current.walls[2] = false
            next.walls[4] = false
        end

        if y == 1 then
            current.walls[3] = false
            next.walls[1] = false
        elseif y == -1 then
            current.walls[1] = false
            next.walls[3] = false
        end
    end

    function generateWallsList()
        for y = 1, rows do
            for x = 1, cols do
                local cell = maze[y][x]
                local x1, y1 = (cell.x - 1) * cellSize, (cell.y - 1) * cellSize
                local x2, y2 = x1 + cellSize, y1 + cellSize

                if cell.walls[1] then
                    table.insert(walls, {{x1, y1}, {x2, y1}}) -- top
                end
                if cell.walls[2] then
                    table.insert(walls, {{x2, y1}, {x2, y2}}) -- right
                end
                if cell.walls[3] then
                    table.insert(walls, {{x2, y2}, {x1, y2}}) -- bottom
                end
                if cell.walls[4] then
                    table.insert(walls, {{x1, y2}, {x1, y1}}) -- left
                end
            end
        end
    end

    function printWallsList()
        print("List of walls:")
        for _, wall in ipairs(walls) do
            print(string.format("{pos = {{%d, %d}, {%d, %d}}},", wall[1][1], wall[1][2], wall[2][1], wall[2][2]))
        end
    end

    local width, height = 100, 100  -- Larger canvas for more cells
    cols = math.floor(width / cellSize)
    rows = math.floor(height / cellSize)

    -- Initialize the maze grid
    for y = 1, rows do
        maze[y] = {}
        for x = 1, cols do
            maze[y][x] = {
                x = x,
                y = y,
                walls = {true, true, true, true}, -- top, right, bottom, left
                visited = false
            }
        end
    end

    current = maze[1][1]
    current.visited = true
    table.insert(stack, current)

    while #stack > 0 do
        local next = getNextNeighbor(current)
        if next then
            next.visited = true
            table.insert(stack, current)
            removeWalls(current, next)
            current = next
        else
            current = table.remove(stack)
        end
    end

    -- Create entrance and exit
    maze[1][1].walls[4] = false  -- Entrance on the left of the top-left cell
    maze[rows][cols].walls[2] = false  -- Exit on the right of the bottom-right cell



    generateWallsList()
    for _, wall in ipairs(walls) do
            wall.body = love.physics.newBody(world, wall[1][1], wall[1][2], "static")        -- Create the body at the first point of the wall
            -- Adjust the shape coordinates relative to the body's position
            local x1, y1 = 0, 0  -- Relative to Wall.body's position (Wall.pos[1])
            local x2, y2 = wall[2][1] - wall[1][1], wall[2][2] - wall[1][2]
            -- Create the shape with corrected coordinates
            wall.shape = love.physics.newEdgeShape(x1, y1, x2, y2)
            -- Attach the shape to the body
            wall.fixture = love.physics.newFixture(wall.body, wall.shape, 1)
            wall.fixture:setUserData("wall" .. _)
            wall.fixture:setCategory(16)

            table.insert(Walls.list, {pos = {{wall[1][1], wall[1][2]}, {wall[2][1], wall[2][2]}}, body = wall.body, shape = wall.shape, fixture = wall.fixture})
    end
    
    return Walls.list
end

return Walls